<article class="gi-article-content gi-col-95 gi-row-90">
    <section class="gi-col-100 gi-row-100">
        <header class="gi-flex gi-flex-center gi-col-10">
            <h1 class="gi-page-title">기관 수정</h1>
        </header>
        <article class="gi-col-90 gi-row-100 gi-grid gi-grid-template-rows-9fr-1fr gi-grid-gap-10px-10px">
            <!--      업데이트 영역      -->
            <form id="commonOfficeModify" class="gi-row-100 gi-col-100 gi-overflow">
                <div class="gi-row-100 gi-padding-5px gi-grid-container gi-grid gi-grid-justify-items-center gi-grid-gap-10px gi-margin-bottom-15px">

                    <div class="gi-row-60 gi-col-100 gi-grid gi-grid-template-columns-repeat-1-1fr-2fr gi-grid-rows-container">
                        <div class="gi-row-100 gi-col-100 gi-flex gi-flex-center gi-layout-detail-title">
                            <span>title</span>
                        </div>
                        <div class="gi-row-100 gi-col-100 gi-grid">
                             <div class="gi-row-100 gi-input-container gi-input-container-box-border gi-flex gi-flex-center ">
                                <label for="top_office_code" class="gi-input-label" data-focus-label="true" data-focus-label-text-align="default" data-required="true">최상위 코드</label>
                                <input data-field="top_office_code" id="top_office_code" name="top_office_code" class="gi-input" data-focus-span-text-align="center" data-required="true" autocomplete="off"/>
                            </div>
                        </div>
                    </div>
                    <div class="gi-row-60 gi-col-100 gi-grid gi-grid-template-columns-repeat-1-1fr-2fr gi-grid-rows-container">
                        <div class="gi-row-100 gi-col-100 gi-flex gi-flex-center gi-layout-detail-title">
                            <span>title</span>
                        </div>
                        <div class="gi-row-100 gi-col-100 gi-grid">
                             <div class="gi-row-100 gi-input-container gi-input-container-box-border gi-flex gi-flex-center ">
                                <label for="office_name" class="gi-input-label" data-focus-label="true" data-focus-label-text-align="default" data-required="true">기관명</label>
                                <input data-field="office_name" id="office_name" name="office_name" class="gi-input" data-focus-span-text-align="center" data-required="true" autocomplete="off"/>
                            </div>
                        </div>
                    </div>
                    <div class="gi-row-60 gi-col-100 gi-grid gi-grid-template-columns-repeat-1-1fr-2fr gi-grid-rows-container">
                        <div class="gi-row-100 gi-col-100 gi-flex gi-flex-center gi-layout-detail-title">
                            <span>title</span>
                        </div>
                        <div class="gi-row-100 gi-col-100 gi-grid">
                             <div class="gi-row-100 gi-input-container gi-input-container-box-border gi-flex gi-flex-center ">
                                <label for="office_code" class="gi-input-label" data-focus-label="true" data-focus-label-text-align="default" data-required="true">기관코드</label>
                                <input data-field="office_code" id="office_code" name="office_code" class="gi-input" data-focus-span-text-align="center" data-required="true" autocomplete="off"/>
                            </div>
                        </div>
                    </div>
                    <div class="gi-row-60 gi-col-100 gi-grid gi-grid-template-columns-repeat-1-1fr-2fr gi-grid-rows-container">
                        <div class="gi-row-100 gi-col-100 gi-flex gi-flex-center gi-layout-detail-title">
                            <span>title</span>
                        </div>
                        <div class="gi-row-100 gi-col-100 gi-grid">
                             <div class="gi-row-100 gi-input-container gi-input-container-box-border gi-flex gi-flex-center ">
                                <label for="office_type" class="gi-input-label" data-focus-label="true" data-focus-label-text-align="default" data-required="false">기관유형</label>
                                <input data-field="office_type" id="office_type" name="office_type" class="gi-input" data-focus-span-text-align="center" data-required="false" autocomplete="off"/>
                            </div>
                        </div>
                    </div>
                    <div class="gi-row-60 gi-col-100 gi-grid gi-grid-template-columns-repeat-1-1fr-2fr gi-grid-rows-container">
                        <div class="gi-row-100 gi-col-100 gi-flex gi-flex-center gi-layout-detail-title">
                            <span>title</span>
                        </div>
                        <div class="gi-row-100 gi-col-100 gi-grid">
                             <div class="gi-row-100 gi-input-container gi-input-container-box-border gi-flex gi-flex-center ">
                                <label for="office_type_code" class="gi-input-label" data-focus-label="true" data-focus-label-text-align="default" data-required="false">등록관청 구분부호</label>
                                <input data-field="office_type_code" id="office_type_code" name="office_type_code" class="gi-input" data-focus-span-text-align="center" data-required="false" autocomplete="off"/>
                            </div>
                        </div>
                    </div>

                    <div class="gi-row-60 gi-col-100 gi-grid gi-grid-template-columns-repeat-1-1fr-2fr gi-grid-rows-container">
                        <div class="gi-row-100 gi-col-100 gi-flex gi-flex-center gi-layout-detail-title">
                            <span>구비서류</span>
                        </div>
                        <div class="gi-row-100 gi-col-100  gi-layout-detail-section">
                            <div class="gi-row-100 gi-input-container gi-input-container-box-border gi-flex gi-flex-center">
                                <label for="file_id" class="gi-input-label" data-focus-label="true" data-focus-label-text-align="default" data-required="true">첨부파일</label>
                                <div class="gi-row-50 gi-col-70">
                                    <div class="gi-btn-section gi-flex gi-flex-center">
                                        <button id="fileUpload" class="gi-btn-file-upload" type="button">파일추가</button>
                                        <input data-field="file_id" id="file_id" name="file_id" class="gi-input gi-hidden" data-focus-span-text-align="center" data-required="true" autocomplete="off"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <!--/     업데이트 영역      -->
            <!--      버튼 영역      -->
            <div class="gi-row-100 gi-col-100 gi-flex gi-flex-justify-content-center gi-flex-align-items-center gi-overflow-scroll">
                <div class="gi-btn-section gi-row-30 gi-col-30px gi-padding-left-right-20px gi-flex gi-flex-justify-content-center gi-flex-align-items-center">
                    <button id="back-btn" class="gi-btn-back" type="button">뒤로가기</button>
                    <button id="modify-btn" class="gi-btn-blue" type="button">수정하기</button>
                </div>
            </div>
            <!--/     버튼 영역      -->
        </article>
    </section>
</article>
<script type="text/javascript">
    var PRGMID = "commonOfficeModify";	//page id
    init();


    function init(){
        dataSetting();

        //초기화
        resetEvent();

        setTimeout(function(){
            //페이지 초기설정
            new PageInit();
            //클릭 이벤트
            clickEvent();
        });

    }

    //리스트에서 받아온 데이터 바인딩처리
    function dataSetting(){
        let data_binding = new dataBinding();

        await data_binding.setData(PRGMID);
        let data = data_binding.getData(PRGMID);
        //초기 값 셋팅
        initValueSetting(data);
    }

    function resetEvent(){
        //데이터 호출 후 이벤트 재설정
        new afterLoadDataEvent();
    }

    //클릭 이벤트
    function clickEvent(){
        // 초기화 버튼 클릭 이벤트
        $(".gi-btn-reset").click(function(){

        });
        //뒤로가기 버튼 클릭 이벤트
        $("#back-btn").click(function(){
            redirectBackPage();
        })
        //수정하기 버튼 클릭 이벤트
        $("#modify-btn").click(function(){
            modify();
        })
    }
    function initValueSetting(data){
        if(formUtil.checkEmptyValue(data.uuid)){
            let url = "/register/file/fileVehicleRegistrationApplication/find";
            //파일다운로드 이벤트 설정
            formUtil.createFileDownload("fileDownload",url,data.uuid);
        }else{
            formUtil.showMessage("file uuid is not exist");
        }
    }
    function modify(){
        let flag =  checkValidation();
        if(flag){
            let data = new dataBinding().getData(PRGMID);
            let url = "/common/common/commonOffice/update";
                //console.log(data);
            let param = {

                top_office_code : data.top_office_code ,
                office_name : data.office_name ,
                office_code : data.office_code ,
                office_type : data.office_type ,
                office_type_code : data.office_type_code 
            };
            axios.post(url,param).then(response =>{
                let status = response.status;
                if (status === 200) {
                    formUtil.showMessage(Message.Label.Array["COMPLETE.UPDATE"]);
                    redirectBackPage();
                } else {
                    resetEvent();
                    formUtil.alertPopup("response status is :" + status);
                }
            }).catch(error => {
                resetEvent();
                formUtil.alertPopup(error);
            })
        }
    }
    function checkValidation(){
        let flag = false;

        let validation = [];
        validation.formId = PRGMID;
        $(".gi-input[data-required='true'],.gi-select[data-required='true']").map((i,item)=>{
            if($(item).data("field")){
                let messageId = $(item).data("field").toUpperCase();
                let message = Message.Label.Array["LICENSE_PLATE_MASTER.CHECK."+messageId];
                validation.push({id:item.id,message:message});
            }
        });
        if(formUtil.validationCheck(validation)){
            flag = true;
        }
        return flag;
    }
    function redirectBackPage(){
        formUtil.loadContent("/common/commonOfficeDetail", "");
    }
</script>