<style>
    .content-div{
        padding: 1rem 2rem;
        min-height: 200px;
    }

    #content img {
        max-width: 100%; /* 부모 크기 안에서 조정 */
        height: auto; /* 비율 유지 */
    }
</style>
<article class="gi-article-content gi-col-95 gi-row-90">
    <section class="gi-col-100 gi-row-100">
        <header class="gi-flex gi-flex-center gi-col-10">
            <h1 class="gi-page-title">사이트 공지팝업 상세</h1>
        </header>
        <article class="gi-col-90 gi-row-100 gi-grid gi-grid-template-rows-9fr-1fr gi-grid-gap-10px-10px">
            <!--      디테일 영역      -->
            <div  class="gi-row-100 gi-col-100 gi-overflow">
                <div id="sitePopupNoticeDetail" class="gi-row-100 gi-padding-5px gi-grid-container gi-grid gi-grid-justify-items-center gi-grid-gap-10px gi-margin-bottom-15px">

                    <input data-field="notice_id" id="notice_id" name="notice_id" class="gi-input gi-hidden" data-focus-span-text-align="default" data-required="true" autocomplete="off"></span>

                    <div class="gi-row-100 gi-padding-5px gi-grid-container gi-grid gi-grid-justify-items-center gi-grid-gap-10px gi-margin-bottom-15px">

                        <div class="gi-row-60 gi-col-100 gi-grid  gi-grid-rows-container gi-grid-template-columns-8fr-2fr  ">
                            <div class="gi-row-100 gi-col-100 gi-grid ">
                                <div class="gi-row-100 gi-col-100 gi-span-container gi-span-container-box-border gi-flex gi-flex-center gi-grid-input-edge-left-top">
                                    <label for="title" class="gi-span-label" data-focus-label="true" data-focus-label-text-align="default" data-required="true">제목</label>
                                    <span data-field="title" id="title" name="title" class="gi-span" data-focus-span-text-align="default" data-required="true" autocomplete="off" style="min-height:var(--default-input-height)"></span>
                                </div>
                            </div>
                            <div class="gi-row-100 gi-col-100 gi-grid ">
                                <div class="gi-row-100 gi-col-100 gi-input-container gi-input-container-box-border gi-flex gi-flex-center-left gi-grid-input-edge-right-top">
                                    <input data-field="use_yn" type="checkbox" id="use_yn" name="use_yn" class="gi-input gi-margin-left-20px" data-focus-span-text-align="default" data-required="false" value="1"></span>
                                    <label for="use_yn" class="gi-input-radio-label " data-focus-label="true" data-focus-label-text-align="default" data-required="false">사용여부</label>
                                </div>
                            </div>
                        </div>

                        <div class="gi-row-60">
                            <div class="">
                                <div class="gi-row-100 gi-col-100 gi-input-container-box-border gi-input-container content-div">
                                    <label for="content" class="gi-span-label" data-focus-label="true" data-focus-label-text-align="default" data-required="true">내용</label>
                                    <div id="content" data-field="content" name="content" data-required="true" class="gi-row-100 gi-col-100 ql-editor"></div>
                                </div>
                            </div>
                        </div>

                        <div class="gi-row-60 gi-col-100 gi-grid gi-grid-template-columns-2fr-8fr gi-grid-rows-container">
                            <div class="gi-row-100 gi-col-100 gi-flex gi-flex-center gi-layout-detail-title gi-grid-input-edge-left-bottom">
                                <span>팝업 옵션</span>
                            </div>
                            <div class="gi-row-100 gi-col-100 gi-grid gi-grid-template-columns-repeat-1-1fr-1fr">
                                <div class="gi-row-100 gi-col-100 gi-grid gi-grid-column-span-2 gi-grid-template-columns-1fr-5fr">
                                    <div  class="gi-row-100 gi-input-container gi-input-container-box-border gi-flex gi-col-100 gi-flex-wrap " style="border-right:none;">
                                        <label for="target_group-div" class="gi-span-label" data-focus-label="true" data-focus-label-text-align="default" data-required="true">대상그룹</label></div>
                                    <div id="target_group-div" class="gi-row-100 gi-input-container gi-input-container-box-border gi-flex gi-col-100 gi-flex-wrap " style="border-left:none; min-height:var(--default-input-height)">
                                    </div>
                                </div>
                                <div class="gi-row-100 gi-col-100 gi-grid">
                                    <div class="gi-row-100 gi-input-container gi-input-container-box-border gi-flex gi-flex-center ">
                                        <label for="start_ymd" class="gi-span-label" data-focus-label="true" data-focus-label-text-align="default" data-required="true">시작일자</label>
                                        <span data-field="start_ymd" id="start_ymd" name="start_ymd" class="gi-span" data-focus-span-text-align="default" data-required="true" autocomplete="off" gi-datepicker></span>
                                    </div>
                                </div>
                                <div class="gi-row-100 gi-col-100 gi-grid">
                                    <div class="gi-row-100 gi-input-container gi-input-container-box-border gi-flex gi-flex-center ">
                                        <label for="end_ymd" class="gi-span-label" data-focus-label="true" data-focus-label-text-align="default" data-required="true">종료일자</label>
                                        <span data-field="end_ymd" id="end_ymd" name="end_ymd" class="gi-span" data-focus-span-text-align="default" data-required="true" autocomplete="off" gi-datepicker></span>
                                    </div>
                                </div>
                                <div class="gi-row-100 gi-col-100 gi-grid">
                                    <div class="gi-row-100 gi-input-container gi-input-container-box-border gi-flex gi-flex-center ">
                                        <label for="start_time_code" class="gi-span-label" data-focus-label="true" data-focus-label-text-align="default" data-required="true">시작시간</label>
                                        <input gi-selectbox data-selectbox-field="time_zone" data-field="start_time_code" id="start_time_code" name="start_time_code" class="gi-input" data-focus-span-text-align="default" data-required="true" autocomplete="off"></span>
                                    </div>
                                </div>
                                <div class="gi-row-100 gi-col-100 gi-grid">
                                    <div class="gi-row-100 gi-input-container gi-input-container-box-border gi-flex gi-flex-center ">
                                        <label for="end_time_code" class="gi-span-label" data-focus-label="true" data-focus-label-text-align="default" data-required="true">종료시간</label>
                                        <input gi-selectbox data-selectbox-field="time_zone" data-field="end_time_code" id="end_time_code" name="end_time_code" class="gi-input" data-focus-span-text-align="default" data-required="true" autocomplete="off"></span>
                                    </div>
                                </div>
                                <div class="gi-row-100 gi-col-100 gi-grid gi-grid-column-span-2 gi-grid-template-columns-repeat-2-1fr-1fr">
                                    <div class="gi-row-100 gi-col-100 gi-grid">
                                        <div class="gi-row-100 gi-span-container gi-span-container-box-border gi-flex gi-flex-center ">
                                            <label for="left" class="gi-span-label" data-focus-label="true" data-focus-label-text-align="default" data-required="true">수평위치(%)</label>
                                            <span data-field="left" id="left" name="left" class="gi-span" data-focus-span-text-align="default" data-required="true" autocomplete="off"></span>
                                        </div>
                                    </div>
                                    <div class="gi-row-100 gi-col-100 gi-grid">
                                        <div class="gi-row-100 gi-span-container gi-span-container-box-border gi-flex gi-flex-center ">
                                            <label for="top" class="gi-span-label" data-focus-label="true" data-focus-label-text-align="default" data-required="true">수직위치(%)</label>
                                            <span data-field="top" id="top" name="top" class="gi-span" data-focus-span-text-align="default" data-required="true" autocomplete="off"></span>
                                        </div>
                                    </div>
                                    <div class="gi-row-100 gi-col-100 gi-grid">
                                        <div class="gi-row-100 gi-span-container gi-span-container-box-border gi-flex gi-flex-center ">
                                            <label for="width" class="gi-span-label" data-focus-label="true" data-focus-label-text-align="default" data-required="true">너비(px)</label>
                                            <span data-field="width" id="width" name="width" class="gi-span" data-focus-span-text-align="default" data-required="true" autocomplete="off"></span>
                                        </div>
                                    </div>
                                    <div class="gi-row-100 gi-col-100 gi-grid">
                                        <div class="gi-row-100 gi-span-container gi-span-container-box-border gi-flex gi-flex-center gi-grid-input-edge-right-bottom">
                                            <label for="height" class="gi-span-label" data-focus-label="true" data-focus-label-text-align="default" data-required="true">높이(px)</label>
                                            <span data-field="height" id="height" name="height" class="gi-span" data-focus-span-text-align="default" data-required="true" autocomplete="off"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="gi-row-100 gi-col-100 gi-flex gi-flex-justify-content-center gi-flex-align-items-center gi-overflow-scroll">
                <div class="gi-btn-section gi-row-30 gi-col-30px gi-padding-left-right-20px gi-flex gi-flex-justify-content-center gi-flex-align-items-center">
                    <button id="back-btn" class="gi-btn-back" type="button">목록</button>
                    <button id="modify-btn" class="gi-btn-blue" type="button">수정</button>
                    <button id="remove-btn" class="gi-btn-blue" type="button">삭제</button>
                </div>
            </div>
        </article>
    </section>
</article>
<script type="text/javascript">
    var PRGMID = "sitePopupNoticeDetail";	//page id
    var selectedData = [];
    init();

    function init(){


        setTimeout(function(){
            //페이지 초기설정
            new PageInit();

            dataSetting();

            //클릭 이벤트
            clickEvent();
        });


    }

    //리스트에서 받아온 데이터 바인딩처리
    async function dataSetting() {
        let data_binding = new dataBinding();
        await data_binding.setData(PRGMID);
        
        let data = data_binding.getData(PRGMID);

        $('#start_time_code_select').prop('disabled',true)
        $('#end_time_code_select').prop('disabled',true)
        $('#use_yn').prop('disabled',true)


        let url = "/common/site/sitePopupNotice/selectNoticeWithTargetGroup";
        let param = {
            notice_id : data.notice_id
        }

        await axios.post(url,param).then(response =>{
            let status = response.status;
            if (status === 200) {
                $('#content').append(response.data[0].content)
                $(`#content img`).on('error', setDefaultImage);
                function setDefaultImage() {
                    console.log(this)
                    $(this)
                        .attr('src', '/common/img/image_not_found.svg')
                        .css({'width': '50%', 'height': 'auto'})
                        .after('<br>');
                }
                response.data.forEach(function (item) {
                    if (item.group_id != null) {
                        let value = $('#target_group-div');
                        let tagClass = (Number(item.group_level) === 0) ? 'gi-tag-blue' : 'gi-tag-gray';

                        value.append('<span class="' + tagClass + ' gi-col-24px" data-group-id="' + item.group_id + '" data-group-level="' + item.group_level + '" data-group-name="' + item.group_name + '">' + item.group_name + '</span>');
                    }
                });

            } else {
            }
        }).catch(error => {
        })

        await resetEvent()

    }

    function resetEvent(){
        //데이터 호출 후 이벤트 재설정
        new afterLoadDataEvent();
    }

    //클릭 이벤트
    function clickEvent(){
        //목록 버튼 클릭 이벤트
        $("#back-btn").click(function(){
            redirectBackPage();
        })
        //수정하기 버튼 클릭 이벤트
        $("#modify-btn").click(function(){
            redirectModifyPage();
        })
        //삭제
        $('#remove-btn').click(function(){
            remove();
        })
    }
    function redirectBackPage(){
        let url = "/common/site/sitePopupNoticeList";
        formUtil.loadContent(url,"");
    }
    function redirectModifyPage(){
        let data = new dataBinding().getData(PRGMID)

        //대상그룹 데이터 주입
        let selectedData = $('#target_group-div span').map(function () {
            return {
                group_id: $(this).data('group-id'),
                group_level: $(this).data('group-level'),
                group_name: $(this).data('group-name')
            };
        }).get();

        data['target_group_list'] = JSON.stringify(selectedData);

        //내용 HTML 전달
        data['content'] = $('#content').html()

        let url = "/common/site/sitePopupNoticeModify";
        formUtil.loadContent(url,data);
    }
    async function remove(){
        if (!await formUtil.confirm(Message.Label.Array["CONFIRM.DELETE"])) {
            return false;
        }

        let url = "/common/site/sitePopupNotice/remove";
        let param = {
            notice_id : $('#notice_id').val()
        };
        await axios.post(url,param).then(response =>{
            let status = response.status;
            if (status === 200) {
                formUtil.showMessage(Message.Label.Array["COMPLETE.DELETE"]);
                redirectBackPage();
            } else {
                resetEvent();
                formUtil.alertPopup("response status is :" + status);
            }
        }).catch(error => {
            resetEvent();
            formUtil.alertPopup(error);
        })
    }
</script>